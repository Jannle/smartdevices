<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>User Research Recruitment</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    body { margin: 0; font-family: sans-serif; background: #f7f7f8; color: #111; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; text-align: center; }
    .hero-wrap { position: relative; display: inline-block; width: 100%; }
    .recruitment-img { width: 100%; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,.18); }
    .share-btn { position: absolute; top: 12px; right: 12px; padding: 8px 12px; font-size: 14px; border: none; border-radius: 20px; background: rgba(17,17,17,0.75); color: #fff; cursor: pointer; backdrop-filter: blur(4px); }
    .share-btn:hover { background: rgba(17,17,17,0.9); }

    .floating-btn { position: fixed; right: 20px; bottom: 20px; padding: 16px 28px; background: #ff5722; color: #fff; border: none; border-radius: 50px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 6px 20px rgba(0,0,0,.18); animation: pulse 1.8s infinite, bounce 3s infinite; }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(255,87,34,.7);}70%{box-shadow:0 0 0 25px rgba(255,87,34,0);}100%{box-shadow:0 0 0 0 rgba(255,87,34,0);} }
    @keyframes bounce { 0%,20%,50%,80%,100%{transform:translateY(0);}40%{transform:translateY(-6px);}60%{transform:translateY(-3px);} }

    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; padding: 10px; }
    .modal-content { background: #fff; border-radius: 12px; padding: 20px; max-width: 400px; width: 90%; }
    .modal.show { display: flex; }
    .close-btn { float: right; cursor: pointer; }
    .question { margin: 12px 0; text-align: left; }
    select, input { width: 100%; padding: 10px; margin-top: 6px; border-radius: 6px; border: 1px solid #ccc; }

    .form-section { margin-top: 16px; display: none; text-align: center; }

    .modal-content.booking { max-width: 920px; width: 96%; padding: 0; overflow: hidden; }
    .booking-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border-bottom: 1px solid #eee; }
    .booking-body { width: 100%; height: 70vh; }
    .booking-body iframe { width: 100%; height: 100%; border: 0; display: block; }

    @media (max-width: 600px){ .booking-body { height: 80vh; } }

    /* Waitlist modal */
    .waitlist-body { text-align: center; }
    .qr { width: 220px; height: 220px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,.15); object-fit: cover; }
    .wa-btn { margin-top: 10px; display: inline-block; padding: 10px 14px; background: #25D366; color: #fff; border-radius: 8px; text-decoration: none; font-weight: 600; }
    .note { color: #555; font-size: 14px; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="hero-wrap">
      <img src="nova14R.png" alt="User Research Recruitment" class="recruitment-img">
      <button class="share-btn" id="shareBtn">Share</button>
    </div>
  </div>

  <button class="floating-btn" onclick="openModal()">Apply Now</button>

  <!-- Eligibility Modal -->
  <div id="myModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()" aria-label="Close">&times;</span>
      <h2>Quick Questions</h2>
      <form id="eligibilityForm">
        <div class="question">
          <label for="brandSelect">What is your device brand?</label>
          <select id="brandSelect" name="brandSelect">
            <option value="" selected disabled>Select your brand</option>
            <option value="garmin">Garmin</option>
            <option value="samsung">Samsung</option>
            <option value="other">Other</option>
          </select>
          <input type="text" id="brandOther" name="brandOther" placeholder="Please specify your brand" style="display:none;" />
        </div>

        <div class="question">
          <label for="modelSelect">What is your device model?</label>
          <select id="modelSelect" name="modelSelect">
            <option value="" selected disabled>Select your model</option>
          </select>
          <input type="text" id="modelOther" name="modelOther" placeholder="Please specify your model" style="display:none;" />
        </div>

        <div class="actions">
          <button type="submit">Submit</button>
          <button type="button" id="cancelBtn">Cancel</button>
        </div>
      </form>
      <div class="form-section" id="formSection">
        <h3>Congratulations! You qualify 🎉</h3>
        <p>Loading booking page...</p>
      </div>
    </div>
  </div>

  <!-- Booking Modal (eligible users) -->
  <div id="bookingModal" class="modal" aria-hidden="true">
    <div class="modal-content booking">
      <div class="booking-header">
        <strong>Book Your Session</strong>
        <span class="close-btn" onclick="closeBooking()" aria-label="Close">&times;</span>
      </div>
      <div class="booking-body">
        <iframe id="bookingFrame" src="" title="Reservation"></iframe>
      </div>
    </div>
  </div>

  <!-- Waitlist Modal (ineligible users) -->
  <div id="waitlistModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close-btn" onclick="closeWaitlist()" aria-label="Close">&times;</span>
      <h3>Not a match right now</h3>
      <p>Please <strong>scan the QR below</strong> to register for future studies, or contact us via WhatsApp:</p>
      <div class="waitlist-body">
        <img id="waitlistQR" class="qr" src="qr-placeholder.png" alt="QR Code" />
        <div style="margin-top:10px;">
          <a id="waLink" class="wa-btn" href="#" target="_blank" rel="noopener">WhatsApp us</a>
        </div>
        <div class="note">We will reach out when a suitable study opens.</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Config =====
    const RESERVATION_URL = 'https://tidycal.com/usersurvey/smrtphone'; // 合格用户预约页面
        const WA_ME_URL = 'https://wa.me/27748706497';               // 你的 WhatsApp wa.me 链接

    const brandSelect = document.getElementById('brandSelect');
    const brandOther = document.getElementById('brandOther');
    const modelSelect = document.getElementById('modelSelect');
    const modelOther = document.getElementById('modelOther');
    const formSection = document.getElementById('formSection');
    const form = document.getElementById('eligibilityForm');

    const bookingModal = document.getElementById('bookingModal');
    const bookingFrame = document.getElementById('bookingFrame');
    const waitlistModal = document.getElementById('waitlistModal');
    const waitlistQR = document.getElementById('waitlistQR');
    const waLink = document.getElementById('waLink');

    // ====== HOW TO EDIT ======
    // 1) 增/减品牌：修改 catalog 对象的键名（全小写）。
    // 2) 增/减型号：在对应品牌数组里增删（全小写，展示文本按数组原样显示）。
    // 选择具体品牌/型号时不显示填空；选择 Other 才显示手动填写输入框；型号的 Other 始终排在最后。
    const catalog = {
      garmin: ["Forruuner 165", "vivoactive 6"],
      samsung: ["galaxy wtch 6", "galaxy watch 7", "galaxy watch 8"]
    };

    function openModal(){ document.getElementById('myModal').classList.add('show'); }
    function closeModal(){ document.getElementById('myModal').classList.remove('show'); }

    // Share button
    const shareBtn = document.getElementById('shareBtn');
    shareBtn.addEventListener('click', async () => {
      const shareData = { title: document.title, text: 'Join our user research', url: location.href };
      if (navigator.share) {
        try { await navigator.share(shareData); } catch(e) {}
      } else {
        try { await navigator.clipboard.writeText(location.href); shareBtn.textContent = 'Link Copied'; setTimeout(()=> shareBtn.textContent = 'Share', 1600); }
        catch(e) { alert('Copy failed, please copy the URL manually.'); }
      }
    });

    brandSelect.addEventListener('change', () => {
      if(brandSelect.value === 'other'){
        brandOther.style.display='block';
        modelSelect.innerHTML='';
        const otherOpt = document.createElement('option');
        otherOpt.value='other'; otherOpt.textContent='Other';
        modelSelect.appendChild(otherOpt);
        modelOther.style.display='block';
      } else if(brandSelect.value){
        brandOther.style.display='none';
        modelOther.style.display='none';
        modelSelect.innerHTML='';
        const placeholder = document.createElement('option');
        placeholder.value=''; placeholder.textContent='Select your model'; placeholder.disabled = true; placeholder.selected = true;
        modelSelect.appendChild(placeholder);
        (catalog[brandSelect.value] || []).forEach(m => {
          const opt=document.createElement('option');
          opt.value=m; opt.textContent=m;
          modelSelect.appendChild(opt);
        });
        const otherOpt = document.createElement('option');
        otherOpt.value='other'; otherOpt.textContent='Other';
        modelSelect.appendChild(otherOpt);
      }
    });

    modelSelect.addEventListener('change', () => {
      if(modelSelect.value==='other'){
        modelOther.style.display='block';
      } else {
        modelOther.style.display='none';
      }
    });

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const brandVal = brandSelect.value==='other' ? brandOther.value.trim().toLowerCase() : brandSelect.value;
      const modelVal = modelSelect.value==='other' ? modelOther.value.trim().toLowerCase() : modelSelect.value;
      if(!brandVal || !modelVal){
        alert('Please complete both brand and model');
        return;
      }
      const isEligible = catalog[brandSelect.value] && catalog[brandSelect.value].includes(modelVal);
      if(isEligible){
        formSection.style.display='block';
        openBooking();
      } else {
        openWaitlist();
      }
    });

    // Booking modal logic
    function openBooking(){
      bookingFrame.src = RESERVATION_URL; // load specified page
      bookingModal.classList.add('show');
    }
    function closeBooking(){
      bookingModal.classList.remove('show');
      setTimeout(()=> { bookingFrame.src=''; }, 150);
    }

    // Waitlist modal logic (ineligible)
    function openWaitlist(){
      waitlistQR.src = qrDataUrl(WA_ME_URL, 220);
      waLink.href = WA_ME_URL;
      waitlistModal.classList.add('show');
    }
    function closeWaitlist(){
      waitlistModal.classList.remove('show');
    }

    // Cancel / close handlers
    document.getElementById('cancelBtn').addEventListener('click', closeModal);
  </script>
  <script>
    /* Minimal QR generator (davidshimjs QRCode.js - trimmed for inline use) */
    // MIT Licensed. Source adapted and minimized for data URL generation.
    (function(){function v(a){this.mode=w;this.data=a}function x(a){this.mode=y;this.data=a}function z(a){this.mode=A;this.data=a}function B(a){this.mode=C;this.data=a}
    var w=1,y=2,A=4,C=8;function D(a,b){this.typeNumber=a;this.errorCorrectLevel=b;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}
    D.prototype={addData:function(a){/^[0-9]*$/.test(a)?this.dataList.push(new v(a)):/^[A-Z0-9 $%*+\-./:]*$/.test(a)?this.dataList.push(new x(a)):encodeURIComponent(a)==a?this.dataList.push(new z(a)):this.dataList.push(new B(unescape(encodeURIComponent(a))))},isDark:function(a,b){if(this.modules[a][b]!=null)return this.modules[a][b];else throw Error(a+","+b);},getModuleCount:function(){return this.moduleCount},make:function(){E(this.typeNumber,this.errorCorrectLevel,this.dataList,this)},createData:function(a,b){var c=[];for(var d=0;d<this.dataList.length;d++){var e=this.dataList[d];switch(e.mode){case w:c.push(1);F(e.data,c);break;case y:c.push(2);G(e.data,c);break;case A:c.push(4);H(e.data,c);break;case C:c.push(8);I(e.data,c)}}J(a,b,c,this)}};function K(a,b){var c=new D(a,b);return c}
    // --- (A huge portion omitted for brevity in this inline trimmed build) ---
    // To keep this snippet short in canvas, we include a tiny prebuilt QR at type 4.
    // For robust production, replace with full qrcode.js. Here we polyfill using QRious-like approach via third-party omitted.
    window.__qrlite__=function(text,size){var canvas=document.createElement('canvas');canvas.width=canvas.height=size||220;var ctx=canvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#000';
      // Fallback: draw a simple finder pattern and encode hash dots (NOT A REAL QR, replace if needed)
      // This fallback ensures the page still shows a code-like image. Replace with full generator in production.
      var s=size||220;var u=s/33;function fp(x,y){ctx.fillRect(x*u,y*u,7*u,7*u);ctx.clearRect((x+1)*u,(y+1)*u,5*u,5*u);ctx.fillRect((x+2)*u,(y+2)*u,3*u,3*u)}fp(1,1);fp(25,1);fp(1,25);
      for(var i=0;i<text.length;i++){var t=text.charCodeAt(i);var X=(i*3)%25+5;var Y=((i*5)%25)+5; if(((t+i)&1)===0){ctx.fillRect(X*u,Y*u,u,u);} }
      return canvas.toDataURL('image/png');};})();
    function qrDataUrl(text, size){
      return window.__qrlite__ ? window.__qrlite__(text, size||220) : '';
    }
  </script>
</body>
</html>
